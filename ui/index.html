<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tekton - AI Orchestration System</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/themes/dark-blue.css" id="theme-stylesheet">
    <link rel="stylesheet" href="styles/ergon.css">
    <link rel="stylesheet" href="styles/settings.css">
    <style>
        /* Streamlined header styles */
        .left-panel-header {
            padding: 12px 16px !important;
            height: 85px !important;
        }
    </style>
</head>
<body data-theme="dark-blue">
    <div class="app-container">
        <!-- Left Panel -->
        <div class="left-panel">
            <div class="left-panel-header">
                <div class="tekton-logo">
                    <div class="logo-text">
                        <h1 style="color: #007bff !important; font-size: 2.5rem !important;">Tekton</h1>
                        <div class="subtitle" style="font-size: 0.9rem !important; color: #aaa !important;">Multi-AI Engineering</div>
                    </div>
                    <img src="images/Tekton.png" alt="Tekton Pillar" class="pillar-icon" style="height: 85px !important; margin-left: 10px !important; position: absolute !important; right: 0 !important; top: 0 !important;" onerror="this.src='images/icon.png'; this.onerror=null;">
                </div>
            </div>
            
            <div class="left-panel-nav">
                <ul class="component-nav">
                    <li class="nav-item active" data-component="tekton">
                        <span class="nav-label">Tekton - Projects</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="prometheus">
                        <span class="nav-label">Prometheus - Planning</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="telos">
                        <span class="nav-label">Telos - Requirements</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="ergon">
                        <span class="nav-label">Ergon - Tools/Agents/Workflows</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="harmonia">
                        <span class="nav-label">Harmonia - Orchestration</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="synthesis">
                        <span class="nav-label">Synthesis - Integration</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="athena">
                        <span class="nav-label">Athena - Knowledge</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="sophia">
                        <span class="nav-label">Sophia - Learning</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="engram">
                        <span class="nav-label">Engram - Memory</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="rhetor">
                        <span class="nav-label">Rhetor - Context</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="hermes">
                        <span class="nav-label">Hermes - Messages/Data</span>
                        <span class="status-indicator"></span>
                    </li>
                    <li class="nav-item" data-component="codex">
                        <span class="nav-label">Codex - Coding</span>
                        <span class="status-indicator"></span>
                    </li>
                </ul>
            </div>
            
            <div class="left-panel-footer">
                <div class="footer-separator"></div>
                <div class="footer-buttons">
                    <button class="control-button" id="budget-button" title="Budget">
                        <span class="button-icon">üí∞</span>
                        <span class="button-label">Budget</span>
                    </button>
                    <button class="control-button" id="profile-button" title="Profile">
                        <span class="button-icon">üë§</span>
                        <span class="button-label">Profile</span>
                    </button>
                    <button class="control-button" id="settings-button" title="Settings">
                        <span class="button-icon">‚öôÔ∏è</span>
                        <span class="button-label">Settings</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Main Panel (full height) -->
            <div class="content-main">
                <div class="panel terminal-panel active" id="terminal-panel">
                    <div id="terminal" class="terminal">
                        <div id="terminal-content" style="padding: 20px; flex: 1; overflow-y: auto;">
                            <div style="color: white; font-size: 16px; margin-bottom: 15px;">
                                <div style="font-size: 20px; color: #00ff00; margin-bottom: 10px;">Welcome to the Tekton Terminal</div>
                                Type your commands below. The terminal provides access to all Tekton components.
                                <br><br>
                                <span style="color: #888;">Type 'help' for a list of available commands.</span>
                            </div>
                        </div>
                        <!-- Fixed terminal input container with higher z-index and vivid styling -->
                        <div id="terminal-input-fixed" style="display: flex; padding: 10px; background: #222; border-top: 2px solid #007bff; position: sticky; bottom: 0; z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.5);">
                            <span style="color: #00ff00; font-weight: bold; margin-right: 10px; font-size: 16px;">></span>
                            <input id="simple-terminal-input" type="text" 
                                style="flex: 1; background: #111; color: white; border: none; padding: 8px; font-size: 16px; outline: none; caret-color: #00ff00;" 
                                placeholder="Type here and press Enter" autofocus>
                        </div>
                    </div>
                </div>
                <div class="panel html-panel" id="html-panel">
                    <!-- HTML controls will be loaded here -->
                </div>
                <div class="panel settings-panel" id="settings-panel">
                    <!-- Settings controls -->
                    <div id="settings-tab-content">
                        <!-- Settings UI will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for system messages and notifications -->
    <div class="modal" id="system-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modal-title">System Message</h2>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Error container for displaying error messages -->
    <div id="error-container"></div>
    
    <!-- No splash screen -->

    <!-- Load scripts -->
    <script src="scripts/main.js"></script>
    <script src="scripts/ui-manager.js"></script>
    <script src="scripts/terminal.js"></script>
    <script src="scripts/storage.js"></script>
    <script src="scripts/websocket.js"></script>
    
    <!-- Settings and theming system -->
    <script src="scripts/settings-manager.js"></script>
    <script src="scripts/settings-ui.js"></script>
    
    <!-- Enhanced terminal chat system -->
    <script src="scripts/terminal-chat.js"></script> <!-- For compatibility -->
    <script src="scripts/terminal-chat-enhanced.js"></script>
    <script src="scripts/hermes-connector.js"></script>
    
    <!-- Component scripts -->
    <script src="scripts/ergon-component.js"></script>
    
    <!-- Direct script for simple terminal input -->
    <script>
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Get the simple input element
        const simpleInput = document.getElementById('simple-terminal-input');
        
        function focusInput() {
          if (simpleInput) {
            simpleInput.focus();
            console.log('Simple input focused');
          }
        }
        
        if (simpleInput) {
          console.log('Found simple terminal input:', simpleInput);
          
          // Focus it immediately and again after a delay
          focusInput();
          setTimeout(focusInput, 500);
          setTimeout(focusInput, 1000);
          
          // Re-focus when clicked anywhere in the terminal
          const terminal = document.getElementById('terminal');
          if (terminal) {
            terminal.addEventListener('click', function(event) {
              if (event.target !== simpleInput) {
                focusInput();
              }
            });
          }
          
          // Add event listener for Enter key
          simpleInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
              const command = this.value.trim();
              console.log('Command entered:', command);
              
              if (command) {
                // Get terminal content container
                const terminalContent = document.getElementById('terminal-content');
                
                // Check if this is a chat message (starts with @ symbol)
                if (command.startsWith('@')) {
                  // Parse the chat target and message
                  const chatMatch = command.match(/^@(\w+)\s+(.+)$/);
                  
                  if (chatMatch && chatMatch.length >= 3) {
                    const chatTarget = chatMatch[1].toLowerCase();
                    const chatMessage = chatMatch[2];
                    let targetContext = null;
                    
                    // Map chat target to context
                    if (chatTarget === 'ergon') {
                      targetContext = 'ergon';
                    } else if (chatTarget === 'awt' || chatTarget === 'team') {
                      targetContext = 'awt-team';
                    } else if (chatTarget === 'agora' || chatTarget === 'all') {
                      targetContext = 'agora';
                    }
                    
                    if (targetContext) {
                      // Display the command in the terminal
                      const outputDiv = document.createElement('div');
                      outputDiv.style.color = 'white';
                      outputDiv.style.padding = '5px 0';
                      outputDiv.style.marginBottom = '5px';
                      outputDiv.innerHTML = '<span style="color: #2962FF;">@' + chatTarget + ':</span> ' + chatMessage;
                      
                      // Append to the terminal content
                      terminalContent.appendChild(outputDiv);
                      
                      // Add the message to the chat interface
                      const chatMessages = document.getElementById(`${targetContext}-chat-messages`);
                      if (chatMessages) {
                        const messageDiv = document.createElement('div');
                        messageDiv.className = 'chat-message user';
                        messageDiv.innerHTML = `
                          <div class="message-content">
                            <div class="message-text">${chatMessage}</div>
                            <div class="message-time">Just now</div>
                          </div>
                        `;
                        
                        chatMessages.appendChild(messageDiv);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        
                        // Display a "Processing..." message only in the target chat
                        const typingDiv = document.createElement('div');
                        typingDiv.className = 'chat-message system typing';
                        typingDiv.innerHTML = `
                          <div class="message-content">
                            <div class="message-text">Processing...</div>
                          </div>
                        `;
                        
                        chatMessages.appendChild(typingDiv);
                        
                        // If the chat tab isn't active, activate it
                        if (window.ergonComponent) {
                          const tabButton = document.querySelector(`.tab-button[data-tab="${targetContext}"]`);
                          if (tabButton && !tabButton.classList.contains('active')) {
                            tabButton.click();
                          }
                        }
                        
                        // Simulate a response (this would be replaced with real backend communication)
                        setTimeout(() => {
                          // Remove typing indicator
                          const typingIndicators = chatMessages.querySelectorAll('.typing');
                          typingIndicators.forEach(indicator => indicator.remove());
                          
                          // Add AI response
                          const responseDiv = document.createElement('div');
                          responseDiv.className = 'chat-message agent';
                          responseDiv.innerHTML = `
                            <div class="message-content">
                              <div class="message-text">I received your message: "${chatMessage}".<br>How can I assist you further?</div>
                              <div class="message-time">Just now</div>
                            </div>
                          `;
                          
                          chatMessages.appendChild(responseDiv);
                          chatMessages.scrollTop = chatMessages.scrollHeight;
                          
                          // Also show in terminal
                          const terminalResponseDiv = document.createElement('div');
                          terminalResponseDiv.style.color = '#00bfff';
                          terminalResponseDiv.style.padding = '5px 0';
                          terminalResponseDiv.style.marginBottom = '10px';
                          terminalResponseDiv.innerHTML = `<span style="color: #00bfff;">[${targetContext}]</span> I received your message: "${chatMessage}". How can I assist you further?`;
                          terminalContent.appendChild(terminalResponseDiv);
                          terminalContent.scrollTop = terminalContent.scrollHeight;
                        }, 1000);
                      }
                    } else {
                      // Unrecognized chat target
                      const outputDiv = document.createElement('div');
                      outputDiv.style.color = 'white';
                      outputDiv.style.padding = '5px 0';
                      outputDiv.style.marginBottom = '5px';
                      outputDiv.innerHTML = '<span style="color: cyan;">> ' + command + '</span>';
                      terminalContent.appendChild(outputDiv);
                      
                      // Show error
                      const errorDiv = document.createElement('div');
                      errorDiv.style.color = '#ff3333';
                      errorDiv.style.padding = '5px 0';
                      errorDiv.style.marginBottom = '10px';
                      errorDiv.innerText = `Unknown chat target: @${chatTarget}. Available targets: @ergon, @team, @agora`;
                      terminalContent.appendChild(errorDiv);
                    }
                  } else {
                    // Malformed chat command
                    const outputDiv = document.createElement('div');
                    outputDiv.style.color = 'white';
                    outputDiv.style.padding = '5px 0';
                    outputDiv.style.marginBottom = '5px';
                    outputDiv.innerHTML = '<span style="color: cyan;">> ' + command + '</span>';
                    terminalContent.appendChild(outputDiv);
                    
                    // Show error
                    const errorDiv = document.createElement('div');
                    errorDiv.style.color = '#ff3333';
                    errorDiv.style.padding = '5px 0';
                    errorDiv.style.marginBottom = '10px';
                    errorDiv.innerText = 'Chat format: @target your message (example: @ergon help)';
                    terminalContent.appendChild(errorDiv);
                  }
                } else {
                  // Regular command, not a chat message
                  // Display the command in the terminal
                  const outputDiv = document.createElement('div');
                  outputDiv.style.color = 'white';
                  outputDiv.style.padding = '5px 0';
                  outputDiv.style.marginBottom = '5px';
                  outputDiv.innerHTML = '<span style="color: cyan;">> ' + command + '</span>';
                  
                  // Append to the terminal content
                  terminalContent.appendChild(outputDiv);
                  
                  // Display a "Processing..." message
                  const processingDiv = document.createElement('div');
                  processingDiv.style.color = '#888';
                  processingDiv.style.padding = '5px 0';
                  processingDiv.style.marginBottom = '10px';
                  processingDiv.innerText = 'Processing...';
                  terminalContent.appendChild(processingDiv);
                  
                  // Send the command via WebSocket
                  if (window.websocketManager) {
                    websocketManager.sendMessage({
                      type: "COMMAND",
                      source: "UI",
                      target: tektonUI.activeComponent || 'SYSTEM',
                      timestamp: new Date().toISOString(),
                      payload: {
                        command: "process_message",
                        message: command
                      }
                    });
                  } else {
                    // Fallback if websocket manager doesn't exist
                    const responseDiv = document.createElement('div');
                    responseDiv.style.color = '#00bfff';
                    responseDiv.style.padding = '5px 0';
                    responseDiv.style.marginBottom = '10px';
                    responseDiv.innerText = 'Command received: ' + command + '\nWebSocket not connected, using demo mode.';
                    terminalContent.appendChild(responseDiv);
                  }
                }
                
                // Clear the input field
                this.value = '';
                
                // Scroll terminal content to bottom
                terminalContent.scrollTop = terminalContent.scrollHeight;
              }
            }
          });
          
          // Add click handler for input container to ensure focus works
          const inputContainer = simpleInput.parentNode;
          if (inputContainer) {
            inputContainer.addEventListener('click', function(event) {
              focusInput();
              // Prevent event propagation
              event.stopPropagation();
            });
          }
        } else {
          console.error('Simple terminal input not found!');
        }
        
        // Add global click handler to focus input
        document.body.addEventListener('click', function() {
          // Check if we're on the terminal panel
          const terminalPanel = document.getElementById('terminal-panel');
          if (terminalPanel && terminalPanel.classList.contains('active')) {
            focusInput();
          }
        });
      });
    </script>
</body>
</html>